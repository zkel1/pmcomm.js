var __pmcomm__=function(){"use strict";function isFunc(a){var b={};return a&&"[object Function]"===b.toString.call(a)}function parseArgs(a){for(var b=[],c=0;c<a.length;++c)b.push(a[c]);return b}function Sender(a,b,c,d){this._window=a,this._origin=b,this._obj=c,this._msgs={};var e=this;window.addEventListener("message",function(a){e._onMsg(a)},!1),d.forEach(function(a){e.__proto__[a]=function(){return e._invoke(a,parseArgs(arguments))}})}function Receiver(objectName){var callback_handler=function(a,b,c,d){return function(){var e={id:a,cbIdx:d,callback_data:JSON.stringify(parseArgs(arguments)),type:RECEIVER};b.postMessage(e,c)}};window.addEventListener("message",function(e){if(e.data.type===SENDER&&e.data.id&&e.data.send&&e.data.send.obj===objectName){var send=e.data.send,obj=eval(send.obj),method=eval(send.obj+"."+send.method),res=null,params=JSON.parse(send.params);send.cbIdxs.forEach(function(a){params[a]=callback_handler(e.data.id,e.source,e.origin,a)});try{res=method.apply(obj,params);var msg={id:e.data.id,result:JSON.stringify(res),type:RECEIVER}}catch(err){console.error(err);var msg={id:e.data.id,error:JSON.stringify(err.toString()),type:RECEIVER}}e.source.postMessage(msg,e.origin)}},!1)}var SENDER="__PMS__",RECEIVER="__PMR__";return Sender.prototype._onMsg=function(a){if(a.data&&a.data.type&&a.data.type===RECEIVER&&a.data.id&&a.data.id in this._msgs){var b=this._msgs[a.data.id];if(a.data.result||a.data.error)a.data.error?b.reject(JSON.parse(a.data.error)):b.resolve(JSON.parse(a.data.result)),b.resolve=b.reject=null;else if("cbIdx"in a.data){var c=a.data.cbIdx,d=b.callbacks[c],e=JSON.parse(a.data.callback_data);try{d.apply(d,e)}catch(f){console.error(f)}}0===Object.keys(b.callbacks).length&&null===b.result&&delete this._msgs[a.data.id]}},Sender.prototype._postMsg=function(a,b,c,d){"undefined"==typeof c&&(c=[]);var e={obj:this._obj,method:b,params:JSON.stringify(c),cbIdxs:d};return this._window.postMessage({type:SENDER,id:a,send:e},"*")},Sender.prototype._invoke=function(a,b){var c=String(Math.random()+(new Date).getTime()),d=this;return new Promise(function(e,f){var g={start:(new Date).getTime(),resolve:e,reject:f,callbacks:{}},h=[];b.forEach(function(a,c){isFunc(a)&&(g.callbacks[c]=a,b[c]=void 0,h.push(c))}),d._msgs[c]=g,d._postMsg(c,a,b,h)})},{Sender:Sender,Receiver:Receiver}}(),PMCommSender=__pmcomm__.Sender,PMCommReceiver=__pmcomm__.Receiver;