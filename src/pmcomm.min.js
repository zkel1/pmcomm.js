var __pmcomm__=function(){"use strict";function isFunc(e){var t={};return e&&"[object Function]"===t.toString.call(e)}function parseArgs(e){for(var t=[],a=0;e.length>a;++a)t.push(e[a]);return t}function Sender(e,t,a,r){this._window=e,this._origin=t,this._obj=a,this._msgs={};var s=this;window.addEventListener("message",function(e){s._onMsg(e)},!1),r.forEach(function(e){s.__proto__[e]=function(){return s._invoke(e,parseArgs(arguments))}})}function Receiver(objectName,methods){var callback_handler=function(e,t,a,r){return function(){var s={id:e,cbIdx:r,callback_data:JSON.stringify(parseArgs(arguments)),type:RECEIVER};t.postMessage(s,a)}};window.addEventListener("message",function(e){if(e.data.type===SENDER&&e.data.id&&e.data.send&&e.data.send.obj===objectName){if(methods&&methods instanceof RegExp&&!methods.test(send.method))throw new UnsupportedMethodException(e.data.id,send.method);if(methods&&methods instanceof Set&&!methods.has(send.method))throw new UnsupportedMethodException(e.data.id,send.method);var send=e.data.send,obj=eval(send.obj),method=eval(send.obj+"."+send.method),res=null,params=JSON.parse(send.params);send.cbIdxs.forEach(function(t){params[t]=callback_handler(e.data.id,e.source,e.origin,t)});try{res=method.apply(obj,params);var msg={id:e.data.id,result:JSON.stringify(res),type:RECEIVER}}catch(err){console.error(e.data.id,err);var msg={id:e.data.id,error:JSON.stringify(""+err),type:RECEIVER}}e.source.postMessage(msg,e.origin)}},!1)}var SENDER="__PMS__",RECEIVER="__PMR__";return Sender.prototype._onMsg=function(e){if(e.data&&e.data.type&&e.data.type===RECEIVER&&e.data.id&&e.data.id in this._msgs){var t=this._msgs[e.data.id];if(e.data.result||e.data.error)e.data.error?t.reject(e.data.id+" "+JSON.parse(e.data.error)):t.resolve(JSON.parse(e.data.result)),t.resolve=t.reject=null;else if("cbIdx"in e.data){var a=e.data.cbIdx,r=t.callbacks[a],s=JSON.parse(e.data.callback_data);try{r.apply(r,s)}catch(n){console.error(e.data.id,n)}}0===Object.keys(t.callbacks).length&&null===t.result&&delete this._msgs[e.data.id]}},Sender.prototype._postMsg=function(e,t,a,r){a===void 0&&(a=[]);var s={obj:this._obj,method:t,params:JSON.stringify(a),cbIdxs:r};return this._window.postMessage({type:SENDER,id:e,send:s},"*")},Sender.prototype._invoke=function(e,t){var a=new String((new Date).getTime())+(Math.random()+""),r=this;return new Promise(function(s,n){var d={start:(new Date).getTime(),resolve:s,reject:n,callbacks:{}},o=[];t.forEach(function(e,a){isFunc(e)&&(d.callbacks[a]=e,t[a]=void 0,o.push(a))}),r._msgs[a]=d,r._postMsg(a,e,t,o)})},{Sender:Sender,Receiver:Receiver}}(),PMCommSender=__pmcomm__.Sender,PMCommReceiver=__pmcomm__.Receiver;